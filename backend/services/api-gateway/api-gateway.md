# api-gateway - единый backend / API

Swagger Editor
```bash
https://editor.swagger.io/
```
File → Import URL
```bash
http://localhost:8080/docs/openapi.yaml
```

По сабжекту нужно иметь единый сервис, через который входит мобильное приложение и фронтенд.
- единый сервер-backend – хранит все данные и является «истиной»
- API, которое используется всеми клиентами и задокументировано (Swagger и т.п.)
- мобильное приложение должно быть только «remote control» к backend (Мобилка ничего сама не делает без бэка)

API-gateway - это единая входная точка:
- принимает все запросы от мобилки / фронтенда;
- прокидывает на нужный микросервис (auth, playlists, vote, users, mock);
- аутентификация (проверка JWT),
- CORS (Cross-Origin Resource Sharing — это механизм безопасности браузеров), по дефолту пока *
- rate-limit
- базовое логирование,
- Защита от DDoS базовая
- Защита auth-service от брутфорса (подбора паролей) базовая (нет отдельного лимита) - от тупого спама по всем ручкам защищает глобальный лимит.
- Защита сервисов от перегрузки - gateway режет количество запросов с одного IP
- на этом уровне нужно делать:
- - не более 10 запросов в секунду с одного IP,
- - попытки логина не чаще 1 раза в секунду,
- - создание плейлистов не чаще раз в 5 секунд.
(отдельные лимиты для /auth/login и /playlists)

---

Rate limiting — ограничение количества запросов от клиента. (github.com/go-chi/httprate)
- не более 10 запросов в секунду с одного IP,
- попытки логина не чаще 1 раза в секунду,
- создание плейлистов не чаще раз в 5 секунд.
Для чего ?

Если умолешенный делает 1000 запросов / секунду:
- rate-limit это должен блокнуть,
- все осталиные мои сервисы будут спокойно жить.

Swagger (OpenAPI) — это описание внешнего API, то есть того, что видит мобильное приложение / фронт.
внешний API = доступно через api-gateway:
- POST /auth/register
- POST /auth/login
- GET /users/me
- GET /users/{id}
- GET /playlists
- POST /playlists
- POST /events/{id}/vote

Дописать user-service (профиль: публичные / для друзей / приватные поля + музыкальные предпочтения).
Протянуть через gateway все остальные сервисы (playlist, vote, realtime).
добить Google OAuth