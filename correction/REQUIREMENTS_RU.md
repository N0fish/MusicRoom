# Check-list Требований Music Room

Этот чек-лист составлен на основе `Agents/subject.txt` (Версия 5.3) и шкалы оценки `Agents/Intra Projects music-room Edit.txt`. Он максимально подробно описывает обязательные требования к Бэкенду, Серверу и Мобильному приложению.

**Легенда:**
- [x] **Полностью реализовано**: Проверено в коде и работает.
- [/] **Частично реализовано**: Найдены доказательства реализации, но требуется доработка или глубокая проверка.
- [ ] **Отсутствует**: Доказательств реализации не найдено.
- [!] **Критическая проблема**: Реализовано, но нарушает ключевое требование (например, нарушение безопасности).

---

## 1. Обязательства Бэкенда (Логика и Сервисы)

### Управление пользователями (`auth-service`, `user-service`)
- [x] **Регистрация**: Поддержка регистрации через Email/Пароль.
- [x] **Логин**: Пользователи могут войти (возвращается JWT).
- [/] **OAuth**: Вход через как минимум 2 стратегии (Найдены Google и 42 Intra).
  - [x] Стратегия 1: Google
  - [x] Стратегия 2: 42 Intra
- [/] **Связывание аккаунтов**: Пользователь может привязать аккаунт социальной сети (Google/42) к существующему профилю. (Клиент имеет методы `link/unlink`, но endpoint в API Gateway требует проверки).
- [x] **Управление профилем**: Пользователь может обновлять никнейм, настройки и т.д.
- [x] **Система друзей**: Пользователи могут добавлять друзей.

### Основные Сервисы
*Необходимо реализовать как минимум 2 из следующих 3 сервисов. Оценка требует проверки реализованных сервисов.*

#### A. Голосование за музыкальные треки (`vote-service`)
- [x] **Создание События**: Пользователь может создать сессию голосования (Event).
- [x] **Настройки События**:
  - [x] **Видимость**: `public` (публичное) vs `private` (частное).
  - [x] **Период голосования**: Поддержка `voteStart` / `voteEnd`.
  - [x] **Режимы доступа (Лицензии)**:
    - [x] `everyone` (все)
    - [x] `invited_only` (только приглашенные)
    - [x] `geo_time` (ограничение по геолокации и времени) - *Схема поддерживает, логику нужно проверить.*
- [x] **Механика Голосования**:
  - [x] Пользователи могут голосовать за треки.
  - [x] Один голос за трек от одного пользователя (ошибка 409 Conflict при дубликате).
  - [x] Подсчет голосов в реальном времени.
  - [x] Владелец события всегда имеет право голоса.

#### B. Делегирование управления музыкой (**ОТСУТСТВУЕТ**)
- [ ] **Связывание устройств**: Привязка нескольких устройств к одному аккаунту.
- [ ] **Логика делегирования**: Позволить пользователю делегировать управление музыкой друзьям.
- [ ] **Управление воспроизведением**: "Slave" (подчиненный) может управлять плеером "Master" (главного) устройства (Play/Pause/Skip).
- *Статус: Не найдено API или сервисов для этой функции.*

#### C. Редактор музыкальных плейлистов (`playlist-service`)
- [x] **CRUD**: Создание, Чтение, Обновление, Удаление плейлистов.
- [x] **Управление треками**: Добавление/Удаление/Перемещение треков.
- [x] **Конкурентность**: Редактирование должно быть безопасным при одновременном доступе (`openapi.yaml` упоминает блокировки строк).
- [/] **Коллаборация**: Поддержка `editMode` подразумевает совместный доступ, нужно проверить синхронизацию в реальном времени.

### API и Архитектура
- [x] **Микросервисы**: Разделение на понятные сервисы (`auth`, `user`, `vote`, `playlist`, `api-gateway`).
- [x] **API Gateway**: Единая точка входа (`localhost:8080`), маршрутизирующая запросы.
- [x] **RESTful API**: Использование JSON и стандартных HTTP методов.
- [x] **Документация**: `openapi.yaml` существует и детализирован.

---

## 2. Обязательства Сервера

### Архитектура и Технологии
- [x] **Язык**: Go (Бэкенд), Swift (Мобильное приложение).
- [x] **Фреймворки**: Использование стандартных решений (Gin/Chi допустимы).
- [x] **База данных**: Postgres (в Makefile/Docker).

### Окружение и Безопасность
- [x] **Docker Compose**: Проект запускается через `docker-compose up --build`.
- [x] **Переменные окружения**: Использование `.env` файлов, добавленных в `.gitignore`.
  - [x] Ключи не захардкожены.
- [ ] **Логи**: Логи сервисов доступны (Нужно проверить `docker compose logs`).

---

## 3. Мобильное Приложение (`mobile` iOS)

### Технологии
- [x] **Язык**: Swift (Нативный).
- [x] **Без кроссплатформы**: Чистая нативная реализация.

### Функции
- [x] **Аутентификация**: Экраны входа/регистрации реализованы.
- [x] **Профиль**: Просмотр и редактирование профиля (`UserClient.swift`).
- [x] **События**: `EventDetailFeature` обрабатывает голосование и треки.
- [/] **Редактор плейлистов**: UI существует, взаимодействует с API.
- [ ] **UI Делегирования**: Интерфейс для "Master/Slave" управления не найден.

### UX/UI
- [/] **Адаптивность**: Приложение поддерживает разные размеры экранов (AutoLayout/SwiftUI).
- [x] **Отзывчивость**: Замечены оптимистичные обновления UI при голосовании.

---

## 4. Критерии Оценки (Специфика)

### Предварительные проверки
- [x] **Содержимое репозитория**: Бэкенд, Мобильное приложение, README.
- [x] **Makefile**: Существует и содержит `up`, `down`, `re`, `logs`.
- [x] **Без бинарников**: Репозиторий чист.

### Функциональное тестирование (Требует проверки)
- [ ] **Ramp-up (Нагрузка)**: Ожидание логов "Server started".
- [ ] **Создание аккаунта**: Тест полного флоу.
- [ ] **OAuth**: Тест входа через Google/42.
- [ ] **Честность голосования**: Тест дубликатов голосов, ограничений по времени.
- [ ] **Синхронизация плейлистов**: Тест одновременного редактирования.

### Бонус (Если применимо)
- [ ] **Чат**: Упоминался в `realtime-service`?
- [ ] **Рекомендации**: ИИ или алгоритмические рекомендации?

---

## Итог Аудита
- **Главный пробел**: "Делегирование управления музыкой" полностью отсутствует как на Бэкенде, так и в Мобильном приложении.
- **Второстепенные пробелы**: Явные эндпоинты "Связывания аккаунтов" в Gateway (могут быть внутренними), глубокая проверка логики "Geo/Time".
- **Сильные стороны**: Надежная архитектура, отличная документация API, чистый код мобильного приложения.
